<!DOCTYPE HTML><html><head><meta charset=utf-8><title>JavaScript new 操作符的执行过程 | Catullus | a Latin poet of the late Roman Republic</title><meta name=author content=Yann-Wang><meta name=description content=写技术，写心情，写日记><meta name=keywords content="new,operation,execution environment"><meta id=viewport name=viewport content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black><meta property=og:title content="JavaScript new 操作符的执行过程"><meta property=og:site_name content=Catullus><meta property=og:image content=/favicon.ico><link href=/favicon.ico rel=icon><link rel=alternate href=/atom.xml title=Catullus type=application/atom+xml><link rel=stylesheet href=/css/style.css media=screen type=text/css></head><body><div class=blog><div class=content><header><div class=site-branding><h1 class=site-title><a href="/">Catullus</a></h1><p class=site-description>a Latin poet of the late Roman Republic</p></div><nav class=site-navigation><ul><li><a href="/">Home</a></li><li><a href=/archives>Archives</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class=article-title><span>JavaScript new 操作符的执行过程</span></h3><div class=article-top-meta><span class=posted-on><a href="/2016/07/25/the-executing-procedure-of-javascript-new-operation/" rel=bookmark><time class="entry-date published" datetime=2016-07-25T02:39:06.000Z>2016-07-25</time></a></span></div><div class=article-content><div class=entry><h3 id=《JavaScript高级程序设计》中的描述><a href=#《JavaScript高级程序设计》中的描述 class=headerlink title=《JavaScript高级程序设计》中的描述></a>《JavaScript高级程序设计》中的描述</h3><ul><li><p>使用new 操作符调用构造函数，会进行以下步骤：</p><ol><li>创建一个新函数对象；</li><li>调用构造函数产生的执行环境中的this指向这个新对象； //该构造函数 不是 新对象 的方法</li><li>执行构造函数中的代码（为新函数对象添加属性）；</li><li>如果函数没有返回其它对象，那么返回这个新函数对象。</li></ol></li><li><p>构造函数的prototype属性被用作新对象的原型</p></li><li>以上是一个原子操作过程。<a id=more></a></li></ul><h3 id=《JavaScript权威指南》中的描述><a href=#《JavaScript权威指南》中的描述 class=headerlink title=《JavaScript权威指南》中的描述></a>《JavaScript权威指南》中的描述</h3><ul><li><p>当计算一个对象创建表达式的值时， 和对象初始化表达式通过{}创建对象的做法一样，Javascript首先创建一个新的空对象， 然后， javascirpt通过传入指定的参数并将这个新对象当作this的值来调用一个指定的函数。这个函数可以使用this来初始化这个新创建对象的属性。</p></li><li><p>那些被当成构造函数的函数不会返回一个值， 并且这个新创建并被初始化后的对象就是整个对象创建表达式的值。如果一个构造函数确实返回了一个对象值， 那么这个对象就作为整个对象创建表达式的值，而新创建的对象就废弃了。</p><figure class="highlight javascript"><figcaption><span>有返回值时</span></figcaption><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=function><span class=keyword>function</span> <span class=title>dd</span>(<span class=params></span>)</span>&#123; <span class=keyword>this</span>.ss = <span class=number>5</span>; <span class=keyword>return</span> &#123;aa:<span class=number>6</span>&#125;; &#125;</span><br><span class=line><span class=keyword>var</span> hh = <span class=keyword>new</span> dd();</span><br><span class=line></span><br><span class=line>hh.ss   <span class=comment>// undefined</span></span><br><span class=line>hh.aa   <span class=comment>// 6    </span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>没返回值时</span></figcaption><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=function><span class=keyword>function</span> <span class=title>dd2</span>(<span class=params></span>)</span>&#123; <span class=keyword>this</span>.ss2 = <span class=number>4</span>; &#125;</span><br><span class=line><span class=keyword>var</span> hh2 = <span class=keyword>new</span> dd2();</span><br><span class=line></span><br><span class=line>hh2.ss2   <span class=comment>// 4</span></span><br><span class=line>hh2.dd2   <span class=comment>// undefined</span></span><br><span class=line>hh2       <span class=comment>// dd2 &#123;ss2: 4&#125;</span></span><br><span class=line>hh2.toString()   <span class=comment>// "[object Object]"</span></span><br><span class=line>hh2()     <span class=comment>// Uncaught TypeError: hh2 is not a function(…)</span></span><br><span class=line>hh2.dd2()  <span class=comment>// Uncaught TypeError: hh2.dd2 is not a function(…)</span></span><br></pre></td></tr></table></figure></li></ul><h3 id=ES5标准文档：对调用构造函数的描述><a href=#ES5标准文档：对调用构造函数的描述 class=headerlink title=ES5标准文档：对调用构造函数的描述></a>ES5标准文档：对<a href=https://www.w3.org/html/ig/zh/wiki/ES5/functions#FunctionDeclaration target=_blank rel=external>调用构造函数</a>的描述</h3><ul><li>当以一个可能的空的参数列表调用函数对象 F 的 [[Construct]] 内部方法，采用以下步骤：<ol><li>令 obj 为新创建的 ECMAScript 原生对象。</li><li>依照 8.12 设定 obj 的所有内部方法。</li><li>设定 obj 的 [[Class]] 内部属性为 “Object”。</li><li>设定 obj 的 [[Extensible]] 内部属性为 true。</li><li>令 proto 为以参数 “prototype” 调用 F 的 [[Get]] 内部属性的值。</li><li>如果 Type(proto) 是 Object，设定 obj 的 [[Prototype]] 内部属性为 proto。</li><li>如果 Type(proto) 不是 Object，设定 obj 的 [[Prototype]] 内部属性为 15.2.4 描述的标准内置的 Object 原型对象。</li><li>以 obj 为 this 值，调用 [[Construct]] 的参数列表为 args，调用 F 的 [[Call]] 内部属性，令 result 为调用结果。</li><li>如果 Type(result) 是 Object，则返回 result。</li><li>返回 obj。</li></ol></li></ul></div></div><div class=article-footer><div class="article-meta pull-left"><span class=post-categories><i class=icon-categories></i> <a href="/categories/technology/">technology</a></span> <span class=post-tags><i class=icon-tags></i> <a href="/tags/new/">new</a><a href="/tags/operation/">operation</a><a href="/tags/execution-environment/">execution environment</a></span></div></div></article><div id=comment><div class=ds-thread data-thread-key="/2016/07/25/the-executing-procedure-of-javascript-new-operation/" data-title="JavaScript new 操作符的执行过程" data-url="http://www.wangyn.net/2016/07/25/the-executing-procedure-of-javascript-new-operation/"></div><script type=text/javascript>
	var duoshuoQuery = {short_name:"Yann-Wang"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script></div></main><footer class=site-footer><p class=site-info>Proudly powered by <a href="https://hexo.io/" target=_blank>Hexo</a> and Theme by <a href=https://github.com/CodeDaraW/Hacker target=_blank>Hacker</a><br>&copy; 2016 Yann-Wang</p></footer></div></div></body></html>