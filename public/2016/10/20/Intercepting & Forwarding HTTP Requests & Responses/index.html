<!DOCTYPE HTML><html><head><meta charset=utf-8><title>请求拦截及转发 | Catullus | a Latin poet of the late Roman Republic</title><meta name=author content=Yann-Wang><meta name=description content=写技术，写心情，写日记><meta name=keywords content="intercept request,forward request"><meta id=viewport name=viewport content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black><meta property=og:title content=请求拦截及转发><meta property=og:site_name content=Catullus><meta property=og:image content=/favicon.ico><link href=/favicon.ico rel=icon><link rel=alternate href=/atom.xml title=Catullus type=application/atom+xml><link rel=stylesheet href=/css/style.css media=screen type=text/css></head><body><div class=blog><div class=content><header><div class=site-branding><h1 class=site-title><a href="/">Catullus</a></h1><p class=site-description>a Latin poet of the late Roman Republic</p></div><nav class=site-navigation><ul><li><a href="/">Home</a></li><li><a href=/archives>Archives</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class=article-title><span>请求拦截及转发</span></h3><div class=article-top-meta><span class=posted-on><a href="/2016/10/20/Intercepting & Forwarding HTTP Requests & Responses/" rel=bookmark><time class="entry-date published" datetime=2016-10-20T12:40:55.000Z>2016-10-20</time></a></span></div><div class=article-content><div class=entry><ul><li>今天聊下请求拦截及转发的位置</li></ul><h4 id=浏览器端－－通过浏览器插件拦截><a href=#浏览器端－－通过浏览器插件拦截 class=headerlink title=浏览器端－－通过浏览器插件拦截></a>浏览器端－－通过浏览器插件拦截</h4><ul><li>配置 switchySharp<ul><li>情景模式： http代理服务器 127.0.0.1 端口3000</li><li>配置切换规则</li><li>将插件设置为自动切换模式</li></ul></li><li>启动写有拦截及转发逻辑的代理服务器，绑定地址为127.0.0.1，端口为3000</li><li>关于代理服务器：可以自己写，也有一些开源产品（比如<a href="http://anyproxy.io/cn/" target=_blank rel=external>anyproxy</a>）</li></ul><h4 id=系统应用软件-比如fiddler><a href=#系统应用软件-比如fiddler class=headerlink title=系统应用软件(比如fiddler)></a>系统应用软件(比如fiddler)</h4><ul><li>Fiddler是一个代理服务器，绑定地址为127.0.0.1，端口8888</li><li>Fiddler启动时，会将默认浏览器的代理服务器设为127.0.0.1:8888</li><li>Fiddler是用C#写出来的，它监听windows系统的80端口，拦截并转发到自己的代理服务器地址</li></ul><a id=more></a><h4 id=修改DNS解析规则-更改域名对应的ip地址><a href=#修改DNS解析规则-更改域名对应的ip地址 class=headerlink title=修改DNS解析规则(更改域名对应的ip地址)></a>修改DNS解析规则(更改域名对应的ip地址)</h4><ul><li>方法一：修改系统本地hosts文件</li><li>方法二：修改本地局域网路由器的DNS解析规则</li></ul><h4 id=服务端反向代理><a href=#服务端反向代理 class=headerlink title=服务端反向代理></a>服务端反向代理</h4><ul><li>服务端反向代理服务器将请求转发给内部的其他服务器，并将得到的响应返回给请求客户端</li><li>开源产品Nginx</li><li>也可以自己用node写个反向代理服务器，监听80端口</li></ul><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre></td><td class=code><pre><span class=line></span><br><span class=line><span class=keyword>var</span> http_proxy = <span class=built_in>require</span>(<span class=string>'http-proxy'</span>);</span><br><span class=line><span class=keyword>var</span> http       = <span class=built_in>require</span>(<span class=string>'http'</span>);</span><br><span class=line></span><br><span class=line><span class=keyword>var</span> proxy      = http_proxy.createProxyServer(&#123;&#125;);</span><br><span class=line></span><br><span class=line>proxy.on(<span class=function><span class=keyword>function</span>(<span class=params>err,req,res</span>)</span>&#123;</span><br><span class=line>    res.writeHead(<span class=number>500</span>,&#123;</span><br><span class=line>        <span class=string>'Content-Type'</span>:<span class=string>'text/plain'</span></span><br><span class=line>    &#125;);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=keyword>var</span> server=http.createServer(<span class=function><span class=keyword>function</span>(<span class=params>req,res</span>)</span>&#123;</span><br><span class=line>    <span class=keyword>var</span> host= req.headers.host;</span><br><span class=line>    <span class=built_in>console</span>.log(host);</span><br><span class=line>    <span class=keyword>switch</span>(host)&#123;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>'www.wangyn.net'</span>:</span><br><span class=line>            proxy.web(req,res,&#123;target:<span class=string>'http://localhost:3000'</span>&#125;);</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>case</span> <span class=string>'shoutbox.wangyn.net'</span>:</span><br><span class=line>            proxy.web(req, res, &#123; target: <span class=string>'http://localhost:8000'</span> &#125;);</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        <span class=keyword>default</span>:</span><br><span class=line>            res.writeHead(<span class=number>200</span>, &#123;</span><br><span class=line>                <span class=string>'Content-Type'</span>: <span class=string>'text/plain'</span></span><br><span class=line>            &#125;);</span><br><span class=line>            res.end(<span class=string>'Welcome to my server!'</span>);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;);</span><br><span class=line><span class=built_in>console</span>.log(<span class=string>"listening on port 80"</span>);</span><br><span class=line>server.listen(<span class=number>80</span>);</span><br></pre></td></tr></table></figure></div></div><div class=article-footer><div class="article-meta pull-left"><span class=post-categories><i class=icon-categories></i> <a href="/categories/technology/">technology</a></span> <span class=post-tags><i class=icon-tags></i> <a href="/tags/intercept-request/">intercept request</a><a href="/tags/forward-request/">forward request</a></span></div></div></article><div id=comment><div class=ds-thread data-thread-key="/2016/10/20/Intercepting & Forwarding HTTP Requests & Responses/" data-title=请求拦截及转发 data-url="http://www.wangyn.net/2016/10/20/Intercepting & Forwarding HTTP Requests & Responses/"></div><script type=text/javascript>
	var duoshuoQuery = {short_name:"Yann-Wang"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script></div></main><footer class=site-footer><p class=site-info>Proudly powered by <a href="https://hexo.io/" target=_blank>Hexo</a> and Theme by <a href=https://github.com/CodeDaraW/Hacker target=_blank>Hacker</a><br>&copy; 2016 Yann-Wang</p></footer></div></div></body></html>