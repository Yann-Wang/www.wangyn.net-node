<!DOCTYPE HTML><html><head><meta charset=utf-8><title>词法作用域与函数式语言 | Catullus | a Latin poet of the late Roman Republic</title><meta name=author content=Yann-Wang><meta name=description content=写技术，写心情，写日记><meta name=keywords content="functional language,lexical scope,dynamic scope"><meta id=viewport name=viewport content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black><meta property=og:title content=词法作用域与函数式语言><meta property=og:site_name content=Catullus><meta property=og:image content=/favicon.ico><link href=/favicon.ico rel=icon><link rel=alternate href=/atom.xml title=Catullus type=application/atom+xml><link rel=stylesheet href=/css/style.css media=screen type=text/css></head><body><div class=blog><div class=content><header><div class=site-branding><h1 class=site-title><a href="/">Catullus</a></h1><p class=site-description>a Latin poet of the late Roman Republic</p></div><nav class=site-navigation><ul><li><a href="/">Home</a></li><li><a href=/archives>Archives</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class=article-title><span>词法作用域与函数式语言</span></h3><div class=article-top-meta><span class=posted-on><a href="/2016/10/01/lexical scope & functional language/" rel=bookmark><time class="entry-date published" datetime=2016-10-01T12:40:55.000Z>2016-10-01</time></a></span></div><div class=article-content><div class=entry><h4 id=作用域-Scope><a href=#作用域-Scope class=headerlink title=作用域(Scope)></a>作用域(Scope)</h4><blockquote><p>From wikipedia: In computer programming, the scope of a name binding – an association of a name to an entity, such as a variable – is the part of a computer program where the binding is valid: where the name can be used to refer to the entity. In other parts of the program the name may refer to a different entity (it may have a different binding), or to nothing at all (it may be unbound).</p></blockquote><ul><li>在程序的某个节点上的作用域指的是，该代码节点能够阅读到的所有实体(entity)，也被称为上下文或者执行环境。（注：entity简单来讲就是由标识符代表的代码和变量）<a id=more></a><h4 id=作用域的表现形式><a href=#作用域的表现形式 class=headerlink title=作用域的表现形式></a>作用域的表现形式</h4></li><li>以上我们提到作用域的讨论依赖具体的程序节点，这个程序节点可以细分为如下两块。<ul><li>源代码的文本片段(area of text)</li><li>源代码的节点运行时(runtime)</li></ul></li><li>如果是第一种情况，我们就称它为lexical scope(词法作用域)</li><li>如果是第二种情况，就称它为dynamic scope(动态作用域)</li></ul><h4 id=词法作用域和动态作用域的执行方式><a href=#词法作用域和动态作用域的执行方式 class=headerlink title=词法作用域和动态作用域的执行方式></a>词法作用域和动态作用域的执行方式</h4><ul><li>对于词法作用域而言，程序在某个节点上运行的时候。变量查找先从该节点所属的函数(或代码块)开始，如果找不到，则往上面一级的函数(或者代码块)开始查找，直到根作用域。</li><li>对于动态作用域而言，由于作用域依赖于runtime，程序在某个节点上运行的时候。变量查找按照执行栈(call stack)进行查找，变量先在执行函数里面查找，如果找不到则往调用该执行函数的栈里面查找。</li><li>使用词法作用域的语言： JavaScript, C,C++,Java,Go,Python,R</li><li>使用动态作用域的语言： Bash</li></ul><h4 id=闭包在语言中的实现方式><a href=#闭包在语言中的实现方式 class=headerlink title=闭包在语言中的实现方式></a>闭包在语言中的实现方式</h4><ul><li>要实现闭包，在数据结构选型方面，肯定不是线性stack，因为闭包在执行时，仍应该保持绑定上下文的不变，而不是去阅读对应的执行环境。而线性(stack)显然无法满足要求</li><li>实际上对于大部分拥有闭包的语言，程序语言采用的是堆(heap)的形式存储上下文non-local变量。 也正因为如此，这些语言基本自带GC(垃圾回收)。</li></ul><h4 id=闭包在github上也有很多的C语言实现><a href=#闭包在github上也有很多的C语言实现 class=headerlink title=闭包在github上也有很多的C语言实现></a>闭包在github上也有很多的C语言实现</h4><ul><li>根据function或者block的词法作用域嵌套关系，在单向链表中存储函数执行的作用域调用栈context&gt;context&gt;context。</li><li>每次新形成一个作用域context的时候，则复制链表之前的数据作为当前函数执行的闭包环境。</li><li>在函数执行时对相关变量进行引用的时候，则沿着当前的上下文单向链表不断向上寻找即可。</li></ul><h6 id=citation><a href=#citation class=headerlink title=citation></a>citation</h6><ul><li><a href=https://zhuanlan.zhihu.com/p/23661004 target=_blank rel=external>词法作用域与函数式编程语言</a></li><li><a href=https://en.wikipedia.org/wiki/Scope_(computer_science target=_blank rel=external>Scope (computer science)</a>)</li></ul></div></div><div class=article-footer><div class="article-meta pull-left"><span class=post-categories><i class=icon-categories></i> <a href="/categories/technology/">technology</a></span> <span class=post-tags><i class=icon-tags></i> <a href="/tags/functional-language/">functional language</a><a href="/tags/lexical-scope/">lexical scope</a><a href="/tags/dynamic-scope/">dynamic scope</a></span></div></div></article><div id=comment><div class=ds-thread data-thread-key="/2016/10/01/lexical scope & functional language/" data-title=词法作用域与函数式语言 data-url="http://www.wangyn.net/2016/10/01/lexical scope & functional language/"></div><script type=text/javascript>
	var duoshuoQuery = {short_name:"Yann-Wang"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script></div></main><footer class=site-footer><p class=site-info>Proudly powered by <a href="https://hexo.io/" target=_blank>Hexo</a> and Theme by <a href=https://github.com/CodeDaraW/Hacker target=_blank>Hacker</a><br>&copy; 2016 Yann-Wang</p></footer></div></div></body></html>